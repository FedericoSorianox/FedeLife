<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Finanzas - Fede Life</title>
    <link rel="stylesheet" href="pages/app.css">
</head>
<body>
    <h1>üîß Test de Funcionalidad de Finanzas</h1>

    <div class="test-section">
        <h2>1. Verificar Inicializaci√≥n</h2>
        <button onclick="testInitialization()" class="btn btn-primary">Probar Inicializaci√≥n</button>
        <div id="initResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>2. Verificar M√©todos Disponibles</h2>
        <button onclick="testMethods()" class="btn btn-primary">Verificar M√©todos</button>
        <div id="methodsResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>3. Ejecutar Diagn√≥stico Completo</h2>
        <button onclick="runFullDiagnosis()" class="btn btn-primary">Diagn√≥stico Completo</button>
        <div id="diagnosisResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>4. Probar Modal de Categor√≠as</h2>
        <button onclick="testCategoryModal()" class="btn btn-primary">Probar Modal</button>
        <div id="modalResult" class="test-result"></div>
    </div>

    <style>
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .btn {
            padding: 10px 20px;
            background: #87ccd8;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn:hover {
            background: #6bb8c4;
        }
    </style>

    <script src="funciones/config-production-fixed.js"></script>
    <script src="funciones/finanzas.js"></script>

    <script>
        function testInitialization() {
            const result = document.getElementById('initResult');
            result.textContent = '‚è≥ Probando inicializaci√≥n...\n';

            setTimeout(() => {
                if (window.financeApp) {
                    result.textContent += '‚úÖ window.financeApp inicializado correctamente\n';
                    result.textContent += `üìä Transacciones: ${window.financeApp.transactions ? window.financeApp.transactions.length : 0}\n`;
                    result.textContent += `üìÇ Categor√≠as: ${window.financeApp.categories ? window.financeApp.categories.length : 0}\n`;
                } else {
                    result.textContent += '‚ùå Error: window.financeApp no est√° definido\n';
                }
            }, 1000);
        }

        function testMethods() {
            const result = document.getElementById('methodsResult');
            result.textContent = 'üîç Verificando m√©todos...\n';

            const methods = [
                'showCategoryDetails',
                'editTransaction',
                'renderDashboard',
                'renderCategories',
                'createCategoryDetailsModal'
            ];

            methods.forEach(method => {
                if (window.financeApp && typeof window.financeApp[method] === 'function') {
                    result.textContent += `‚úÖ ${method}\n`;
                } else {
                    result.textContent += `‚ùå ${method} - NO DISPONIBLE\n`;
                }
            });
        }

        function runFullDiagnosis() {
            const result = document.getElementById('diagnosisResult');
            result.textContent = 'üîç Ejecutando diagn√≥stico completo...\n';

            if (window.diagnoseFinanceApp) {
                // Redirigir console.log a nuestro resultado
                const originalLog = console.log;
                const originalError = console.error;
                let logs = [];

                console.log = (...args) => {
                    logs.push(args.join(' '));
                    originalLog(...args);
                };

                console.error = (...args) => {
                    logs.push('ERROR: ' + args.join(' '));
                    originalError(...args);
                };

                window.diagnoseFinanceApp();

                // Restaurar console
                setTimeout(() => {
                    console.log = originalLog;
                    console.error = originalError;
                    result.textContent = logs.join('\n');
                }, 100);
            } else {
                result.textContent = '‚ùå Funci√≥n diagnoseFinanceApp no disponible';
            }
        }

        function testCategoryModal() {
            const result = document.getElementById('modalResult');
            result.textContent = 'üîç Probando modal de categor√≠as...\n';

            if (window.financeApp && window.financeApp.categories && window.financeApp.categories.length > 0) {
                const firstCategory = window.financeApp.categories[0];
                result.textContent += `üìÇ Probando con categor√≠a: ${firstCategory.name} (${firstCategory.id})\n`;

                if (typeof window.financeApp.showCategoryDetails === 'function') {
                    result.textContent += '‚úÖ M√©todo showCategoryDetails disponible\n';
                    result.textContent += 'üéØ Ejecutando showCategoryDetails...\n';

                    try {
                        window.financeApp.showCategoryDetails(firstCategory.id);
                        result.textContent += '‚úÖ Modal ejecutado sin errores\n';
                    } catch (error) {
                        result.textContent += `‚ùå Error ejecutando modal: ${error.message}\n`;
                    }
                } else {
                    result.textContent += '‚ùå M√©todo showCategoryDetails no disponible\n';
                }
            } else {
                result.textContent += '‚ùå No hay categor√≠as disponibles para probar\n';
            }
        }

        // Auto-ejecutar diagn√≥stico b√°sico al cargar
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('üöÄ Test page loaded');
                if (window.financeApp) {
                    console.log('‚úÖ FinanceApp loaded successfully');
                } else {
                    console.error('‚ùå FinanceApp not loaded');
                }
            }, 2000);
        });
    </script>
</body>
</html>
