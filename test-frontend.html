<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test Frontend - Fedelife</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Frontend - Fedelife</h1>
    
    <div class="test-section">
        <h2>üìã Estado del Sistema</h2>
        <div id="systemStatus">
            <p><strong>Configuraci√≥n:</strong> <span id="configStatus">Verificando...</span></p>
            <p><strong>API:</strong> <span id="apiStatus">Verificando...</span></p>
            <p><strong>Frontend:</strong> <span id="frontendStatus">Verificando...</span></p>
        </div>
    </div>

    <div class="test-section">
        <h2>üìù Test de Transacci√≥n</h2>
        <form id="testTransactionForm">
            <div class="form-group">
                <label for="testType">Tipo:</label>
                <select id="testType" required>
                    <option value="">Seleccionar tipo</option>
                    <option value="income">Ingreso</option>
                    <option value="expense">Gasto</option>
                </select>
            </div>
            <div class="form-group">
                <label for="testAmount">Monto:</label>
                <input type="number" id="testAmount" placeholder="1000" step="0.01" required>
            </div>
            <div class="form-group">
                <label for="testDescription">Descripci√≥n:</label>
                <input type="text" id="testDescription" placeholder="Descripci√≥n de prueba" required>
            </div>
            <div class="form-group">
                <label for="testCategory">Categor√≠a:</label>
                <select id="testCategory" required>
                    <option value="">Seleccionar categor√≠a</option>
                </select>
            </div>
            <div class="form-group">
                <label for="testDate">Fecha:</label>
                <input type="date" id="testDate" required>
            </div>
            <div class="form-group">
                <label for="testPaymentMethod">M√©todo de pago:</label>
                <select id="testPaymentMethod" required>
                    <option value="">Seleccionar m√©todo</option>
                    <option value="cash">Efectivo</option>
                    <option value="card">Tarjeta</option>
                    <option value="transfer">Transferencia</option>
                    <option value="check">Cheque</option>
                </select>
            </div>
            <button type="submit">üß™ Probar Transacci√≥n</button>
        </form>
    </div>

    <div class="test-section">
        <h2>ü§ñ Test de IA (PDF)</h2>
        <button onclick="testPdfAnalysis()">üß™ Probar An√°lisis de PDF</button>
        <div id="pdfTestResult"></div>
    </div>

    <div class="test-section">
        <h2>üè∑Ô∏è Test de Categor√≠as</h2>
        <button onclick="testCategories()">üß™ Probar Categor√≠as</button>
        <div id="categoriesTestResult"></div>
    </div>

    <!-- Scripts -->
    <script src="/funciones/config-production-fixed.js"></script>
    <script src="/funciones/finanzas-simple.js"></script>
    
    <script>
        // Configurar fecha por defecto
        document.getElementById('testDate').value = new Date().toISOString().split('T')[0];
        
        // Verificar estado del sistema
        async function checkSystemStatus() {
            try {
                // Verificar configuraci√≥n
                if (window.productionConfig) {
                    document.getElementById('configStatus').textContent = '‚úÖ Cargada';
                    document.getElementById('configStatus').style.color = 'green';
                } else {
                    document.getElementById('configStatus').textContent = '‚ùå No disponible';
                    document.getElementById('configStatus').style.color = 'red';
                }
                
                // Verificar API
                try {
                    const response = await fetch('/api/health');
                    if (response.ok) {
                        document.getElementById('apiStatus').textContent = '‚úÖ Funcionando';
                        document.getElementById('apiStatus').style.color = 'green';
                    } else {
                        document.getElementById('apiStatus').textContent = '‚ùå Error';
                        document.getElementById('apiStatus').style.color = 'red';
                    }
                } catch (error) {
                    document.getElementById('apiStatus').textContent = '‚ùå No disponible';
                    document.getElementById('apiStatus').style.color = 'red';
                }
                
                // Verificar frontend
                if (window.financeApp) {
                    document.getElementById('frontendStatus').textContent = '‚úÖ Inicializado';
                    document.getElementById('frontendStatus').style.color = 'green';
                } else {
                    document.getElementById('frontendStatus').textContent = '‚ùå No inicializado';
                    document.getElementById('frontendStatus').style.color = 'red';
                }
                
            } catch (error) {
                console.error('Error verificando estado:', error);
            }
        }
        
        // Test de transacci√≥n
        document.getElementById('testTransactionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            try {
                const formData = {
                    type: document.getElementById('testType').value,
                    amount: parseFloat(document.getElementById('testAmount').value),
                    description: document.getElementById('testDescription').value,
                    category: document.getElementById('testCategory').value,
                    date: document.getElementById('testDate').value,
                    paymentMethod: document.getElementById('testPaymentMethod').value
                };
                
                const response = await fetch('/api/public/transactions/public', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showStatus(`‚úÖ Transacci√≥n creada: ${result.data.transaction.description}`, 'success');
                } else {
                    const error = await response.json();
                    showStatus(`‚ùå Error: ${error.message}`, 'error');
                }
                
            } catch (error) {
                showStatus(`‚ùå Error: ${error.message}`, 'error');
            }
        });
        
        // Test de an√°lisis de PDF
        async function testPdfAnalysis() {
            try {
                const response = await fetch('/api/public/ai/analyze-pdf', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ pdf: 'test' })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    document.getElementById('pdfTestResult').innerHTML = `
                        <div class="status success">
                            ‚úÖ PDF analizado: ${result.data.analysis.expenses.length} gastos encontrados
                        </div>
                    `;
                } else {
                    const error = await response.json();
                    document.getElementById('pdfTestResult').innerHTML = `
                        <div class="status error">
                            ‚ùå Error: ${error.message}
                        </div>
                    `;
                }
                
            } catch (error) {
                document.getElementById('pdfTestResult').innerHTML = `
                    <div class="status error">
                        ‚ùå Error: ${error.message}
                    </div>
                `;
            }
        }
        
        // Test de categor√≠as
        async function testCategories() {
            try {
                const response = await fetch('/api/public/categories/public');
                
                if (response.ok) {
                    const result = await response.json();
                    document.getElementById('categoriesTestResult').innerHTML = `
                        <div class="status success">
                            ‚úÖ Categor√≠as cargadas: ${result.data.categories.length} disponibles
                        </div>
                    `;
                } else {
                    const error = await response.json();
                    document.getElementById('categoriesTestResult').innerHTML = `
                        <div class="status error">
                            ‚ùå Error: ${error.message}
                        </div>
                    `;
                }
                
            } catch (error) {
                document.getElementById('categoriesTestResult').innerHTML = `
                    <div class="status error">
                        ‚ùå Error: ${error.message}
                    </div>
                `;
            }
        }
        
        // Mostrar estado
        function showStatus(message, type) {
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            
            document.body.insertBefore(statusDiv, document.body.firstChild);
            
            setTimeout(() => {
                if (statusDiv.parentNode) {
                    statusDiv.parentNode.removeChild(statusDiv);
                }
            }, 5000);
        }
        
        // Inicializar cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkSystemStatus, 1000);
        });
    </script>
</body>
</html>
