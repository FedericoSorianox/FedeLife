<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Dropdown de Categor√≠as</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #0056b3;
        }
        .categories-display {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .category-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .category-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .category-name {
            flex: 1;
        }
        .category-type {
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>üß™ Test - Dropdown de Categor√≠as</h1>
    
    <div class="form-group">
        <label for="transactionType">Tipo de Transacci√≥n:</label>
        <select id="transactionType">
            <option value="">Seleccionar tipo</option>
            <option value="income">Ingreso</option>
            <option value="expense">Gasto</option>
        </select>
    </div>

    <div class="form-group">
        <label for="transactionCategory">Categor√≠a:</label>
        <select id="transactionCategory">
            <option value="">Seleccionar categor√≠a</option>
        </select>
    </div>

    <div class="form-group">
        <label for="filterCategory">Filtro de Categor√≠as:</label>
        <select id="filterCategory">
            <option value="">Todas las categor√≠as</option>
        </select>
    </div>

    <button onclick="addTestCategory()">‚ûï Agregar Categor√≠a de Prueba</button>
    <button onclick="clearCategories()">üóëÔ∏è Limpiar Categor√≠as</button>
    <button onclick="refreshDropdowns()">üîÑ Refrescar Dropdowns</button>

    <div class="categories-display">
        <h3>Categor√≠as Actuales:</h3>
        <div id="categoriesList">
            <!-- Las categor√≠as se mostrar√°n aqu√≠ -->
        </div>
    </div>

    <script>
        // Sistema simple de categor√≠as para testing
        class CategoryManager {
            constructor() {
                this.categories = [];
                this.loadCategories();
                this.setupEventListeners();
                this.refreshDropdowns();
                this.displayCategories();
            }

            loadCategories() {
                const stored = localStorage.getItem('test_categories');
                if (stored) {
                    this.categories = JSON.parse(stored);
                } else {
                    // Categor√≠as por defecto
                    this.categories = [
                        { id: '1', name: 'Salario', type: 'income', color: '#27ae60' },
                        { id: '2', name: 'Freelance', type: 'income', color: '#2ecc71' },
                        { id: '3', name: 'Alimentaci√≥n', type: 'expense', color: '#e74c3c' },
                        { id: '4', name: 'Transporte', type: 'expense', color: '#f39c12' },
                        { id: '5', name: 'Vivienda', type: 'expense', color: '#e67e22' }
                    ];
                    this.saveCategories();
                }
            }

            saveCategories() {
                localStorage.setItem('test_categories', JSON.stringify(this.categories));
            }

            setupEventListeners() {
                const transactionType = document.getElementById('transactionType');
                if (transactionType) {
                    transactionType.addEventListener('change', () => this.handleTransactionTypeChange());
                }
            }

            populateTransactionCategoryDropdown() {
                const categoryDropdown = document.getElementById('transactionCategory');
                if (!categoryDropdown) return;

                categoryDropdown.innerHTML = '<option value="">Categor√≠a</option>';

                // Agregar categor√≠as de ingresos
                const incomeCategories = this.categories.filter(cat => cat.type === 'income');
                if (incomeCategories.length > 0) {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = 'Ingresos';
                    
                    incomeCategories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.name;
                        option.textContent = category.name;
                        option.style.color = category.color;
                        optgroup.appendChild(option);
                    });
                    
                    categoryDropdown.appendChild(optgroup);
                }

                // Agregar categor√≠as de gastos
                const expenseCategories = this.categories.filter(cat => cat.type === 'expense');
                if (expenseCategories.length > 0) {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = 'Gastos';
                    
                    expenseCategories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.name;
                        option.textContent = category.name;
                        option.style.color = category.color;
                        optgroup.appendChild(option);
                    });
                    
                    categoryDropdown.appendChild(optgroup);
                }
            }

            populateFilterCategoryDropdown() {
                const filterCategoryDropdown = document.getElementById('filterCategory');
                if (!filterCategoryDropdown) return;

                filterCategoryDropdown.innerHTML = '<option value="">Todas las categor√≠as</option>';

                this.categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.name;
                    option.textContent = category.name;
                    option.style.color = category.color;
                    filterCategoryDropdown.appendChild(option);
                });
            }

            handleTransactionTypeChange() {
                const transactionType = document.getElementById('transactionType').value;
                const categoryDropdown = document.getElementById('transactionCategory');
                
                if (!categoryDropdown) return;

                categoryDropdown.innerHTML = '<option value="">Categor√≠a</option>';

                if (!transactionType) {
                    this.populateTransactionCategoryDropdown();
                    return;
                }

                const filteredCategories = this.categories.filter(cat => cat.type === transactionType);
                
                if (filteredCategories.length === 0) {
                    categoryDropdown.innerHTML = '<option value="">No hay categor√≠as disponibles</option>';
                    return;
                }

                filteredCategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.name;
                    option.textContent = category.name;
                    option.style.color = category.color;
                    categoryDropdown.appendChild(option);
                });

                categoryDropdown.value = '';
            }

            refreshDropdowns() {
                this.populateTransactionCategoryDropdown();
                this.populateFilterCategoryDropdown();
            }

            displayCategories() {
                const container = document.getElementById('categoriesList');
                if (!container) return;

                container.innerHTML = this.categories.map(category => `
                    <div class="category-item">
                        <div class="category-color" style="background-color: ${category.color}"></div>
                        <div class="category-name">${category.name}</div>
                        <div class="category-type">${category.type === 'income' ? 'üí∞ Ingreso' : 'üí∏ Gasto'}</div>
                    </div>
                `).join('');
            }

            addCategory(name, type, color) {
                const newCategory = {
                    id: Date.now().toString(),
                    name: name,
                    type: type,
                    color: color
                };
                this.categories.push(newCategory);
                this.saveCategories();
                this.refreshDropdowns();
                this.displayCategories();
            }

            clearCategories() {
                this.categories = [];
                this.saveCategories();
                this.refreshDropdowns();
                this.displayCategories();
            }
        }

        // Inicializar el manager
        const categoryManager = new CategoryManager();

        // Funciones globales para testing
        function addTestCategory() {
            const types = ['income', 'expense'];
            const names = ['Test Ingreso', 'Test Gasto', 'Nueva Categor√≠a', 'Categor√≠a de Prueba'];
            const colors = ['#3498db', '#9b59b6', '#e67e22', '#1abc9c'];
            
            const randomType = types[Math.floor(Math.random() * types.length)];
            const randomName = names[Math.floor(Math.random() * names.length)];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            
            categoryManager.addCategory(randomName, randomType, randomColor);
        }

        function clearCategories() {
            categoryManager.clearCategories();
        }

        function refreshDropdowns() {
            categoryManager.refreshDropdowns();
        }
    </script>
</body>
</html>
