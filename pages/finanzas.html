<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <title>Fede Life - Finanzas Personales</title>
    <link rel="stylesheet" href="app.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- PDF.js Library para procesamiento de PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <!-- Chart.js Library para gráficos interactivos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="body">
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <span class="nav-title">Fede Life</span>
            </div>
            <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-menu" id="navMenu">
                <li><a href="index.html">Inicio</a></li>
                <li><a href="finanzas.html" class="active">Finanzas</a></li>
                <li><a href="ideas.html">Ideas</a></li>
                <li><a href="tareas.html">Tareas</a></li>
                <li><a href="bruce.html">Bruce</a></li>
            </ul>
        </div>
    </nav>

    <header style="background-color: #87ccd8;">
        <div class="header-content">
            <div class="header-text">
                <h1><i class="fas fa-chart-line"></i> Finanzas Personales</h1>
                <p class="textcenter">Controla y optimiza tu economía personal</p>
            </div>
            <div class="header-auth">
                <button id="authButton" onclick="authUI.showLoginModal()" style="display: block;">
                    🔐 Iniciar Sesión
                </button>
                <button id="autoAuthButton" style="display: block;" class="auto-auth-btn">
                    🤖 Auto Login
                </button>
                <div id="userInfo" style="display: none;">
                    <span id="userName">Usuario</span>
                    <button id="logoutBtn" class="logout-btn">🚪 Cerrar Sesión</button>
                </div>
            </div>
        </div>
    </header>

    <section class="section">
        <!-- Dashboard de Resumen -->
        <div class="finance-dashboard">
            <h2 class="dashboard-title">Resumen Financiero del Mes</h2>

            <div class="summary-cards">
                <div class="summary-card income" id="incomeCard" role="button" tabindex="0" title="Hacer clic para agregar un ingreso">
                    <div class="card-icon">
                        <i class="fas fa-arrow-up"></i>
                    </div>
                    <div class="card-content">
                        <h3>Ingresos</h3>
                        <p class="amount" id="totalIncome">$0.00</p>
                        <span class="period">Este mes</span>
                    </div>
                    <div class="card-action-indicator">
                        <i class="fas fa-plus"></i>
                    </div>
                </div>

                <div class="summary-card expense" id="expenseCard" role="button" tabindex="0" title="Hacer clic para agregar un gasto">
                    <div class="card-icon">
                        <i class="fas fa-arrow-down"></i>
                    </div>
                    <div class="card-content">
                        <h3>Gastos</h3>
                        <p class="amount" id="totalExpenses">$0.00</p>
                        <span class="period">Este mes</span>
                    </div>
                    <div class="card-action-indicator">
                        <i class="fas fa-plus"></i>
                    </div>
                </div>

                <div class="summary-card balance">
                    <div class="card-icon">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="card-content">
                        <h3>Balance</h3>
                        <p class="amount" id="totalBalance">$0.00</p>
                        <span class="period">Este mes</span>
                    </div>
                </div>

                <div class="summary-card savings">
                    <div class="card-icon">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <div class="card-content">
                        <h3>Ahorros</h3>
                        <p class="amount" id="totalSavings">$0.00</p>
                        <span class="period">Total</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gráficos Interactivos -->
        <div class="charts-section">
            <h2 class="charts-title">Análisis Visual de Finanzas</h2>
            
            <div class="charts-container">
                <!-- Gráfico de Gastos por Categoría -->
                <div class="chart-card">
                    <h3><i class="fas fa-chart-pie"></i> Gastos por Categoría</h3>
                    <div class="chart-wrapper">
                        <canvas id="expensesChart" width="400" height="400"></canvas>
                    </div>
                    <div class="chart-legend" id="expensesLegend">
                        <!-- La leyenda se generará dinámicamente -->
                    </div>
                </div>

                <!-- Gráfico de Ingresos por Categoría -->
                <div class="chart-card">
                    <h3><i class="fas fa-chart-pie"></i> Ingresos por Categoría</h3>
                    <div class="chart-wrapper">
                        <canvas id="incomeChart" width="400" height="400"></canvas>
                    </div>
                    <div class="chart-legend" id="incomeLegend">
                        <!-- La leyenda se generará dinámicamente -->
                    </div>
                </div>
            </div>

            <!-- Controles de los gráficos -->
            <div class="chart-controls">
                <div class="chart-period-selector">
                    <label>Período:</label>
                    
                    <!-- Sistema de navegación de meses para charts (igual que transacciones) -->
                    <div class="month-filter-container">
                        <div class="month-filter-header">
                            <button type="button" id="chartPrevMonthBtn" class="month-nav-btn" title="Mes anterior">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <div class="month-display">
                                <span id="chartCurrentMonthDisplay">Mes actual</span>
                                <button type="button" id="chartMonthSelectorBtn" class="month-selector-btn" title="Seleccionar mes">
                                    <i class="fas fa-calendar-alt"></i>
                                </button>
                            </div>
                            <button type="button" id="chartNextMonthBtn" class="month-nav-btn" title="Mes siguiente">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <input type="month" id="chartFilterMonth" style="display: none;">
                    </div>
                    
                    <!-- Opciones de período adicionales -->
                    <select id="chartPeriod" style="margin-left: 10px;">
                        <option value="current-month">Mes actual</option>
                        <option value="last-month">Mes anterior</option>
                        <option value="last-3-months">Últimos 3 meses</option>
                        <option value="current-year">Año actual</option>
                        <option value="all-time">Todo el tiempo</option>
                    </select>
                </div>
                <button id="refreshCharts" class="refresh-btn">
                    <i class="fas fa-sync-alt"></i> Actualizar Gráficos
                </button>
            </div>
        </div>

        <!-- Navegación por pestañas -->
        <div class="finance-tabs">
            <button class="tab-btn active" data-tab="transactions">
                <i class="fas fa-exchange-alt"></i> Transacciones
            </button>
          
            <button class="tab-btn" data-tab="goals">
                <i class="fas fa-target"></i> Metas
            </button>
            <button class="tab-btn" data-tab="reports">
                <i class="fas fa-chart-bar"></i> Reportes
            </button>
            <button class="tab-btn" data-tab="categories">
                <i class="fas fa-chart-bar"></i> Categorías
            </button>
        </div>

        <!-- Pestaña de Transacciones -->
        <div id="transactions" class="tab-content active">
            <div class="transactions-section">
                <div class="add-transaction-form">
                    <h3><i class="fas fa-plus-circle"></i> Agregar Transacción</h3>
                    <form id="transactionForm" class="transaction-form">
                        <div class="form-row">
                            <select id="transactionType" required>
                                <option value="">Tipo de transacción</option>
                                <option value="income">Ingreso</option>
                                <option value="expense">Gasto</option>
                            </select>
                            <input type="number" id="transactionAmount" placeholder="Monto" step="0.01" required>
                        </div>
                        <div class="form-row">
                            <input type="text" id="transactionDescription" placeholder="Descripción" required>
                            <select id="transactionCategory" required>
                                <option value="">Categoría</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <input type="date" id="transactionDate" required>
                            <select id="paymentMethod" required>
                                <option value="">Método de pago</option>
                                <option value="cash">Efectivo</option>
                                <option value="card">Tarjeta</option>
                                <option value="transfer">Transferencia</option>
                                <option value="check">Cheque</option>
                            </select>
                        </div>
                        <button type="submit" class="add-btn">
                            <i class="fas fa-plus"></i> Agregar Transacción
                        </button>
                    </form>

                    <!-- PDF Uploader Section -->
                    <div class="pdf-uploader-section">
                        <h4><i class="fas fa-file-pdf"></i> Subir PDF de Gastos</h4>
                        <p class="uploader-description">Sube un PDF (estado de cuenta, recibos, etc.) y el sistema extraerá automáticamente los gastos usando IA</p>
                        
                        <div class="pdf-uploader">
                            <input type="file" id="pdfFile" accept=".pdf" class="pdf-input">
                            <label for="pdfFile" class="pdf-label">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <span>Seleccionar archivo PDF</span>
                            </label>
                            <button type="button" id="processPdfBtn" class="process-btn" disabled>
                                <i class="fas fa-magic"></i> Analizar con IA
                            </button>
                        </div>

                        <div id="pdfProcessingStatus" class="processing-status" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span>Procesando PDF y analizando gastos...</span>
                        </div>

                        <!-- Resultados del análisis -->
                        <div id="extractedExpenses" class="extracted-expenses" style="display: none;">
                            <h5><i class="fas fa-list-alt"></i> Gastos Encontrados</h5>
                            <div class="expenses-actions">
                                <button type="button" id="selectAllExpenses" class="action-btn">
                                    <i class="fas fa-check-square"></i> Seleccionar Todos
                                </button>
                                <button type="button" id="addSelectedExpenses" class="add-btn" disabled>
                                    <i class="fas fa-plus-circle"></i> Agregar Seleccionados
                                </button>
                            </div>
                            <div id="expensesList" class="expenses-list">
                                <!-- Los gastos extraídos se mostrarán aquí -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="transactions-list">
                    <div class="transactions-header">
                        <h3><i class="fas fa-list"></i> Historial de Transacciones</h3>
                        <div class="filter-controls">
                            <select id="filterType">
                                <option value="">Todos los tipos</option>
                                <option value="income">Ingresos</option>
                                <option value="expense">Gastos</option>
                            </select>
                            <select id="filterCategory">
                                <option value="">Todas las categorías</option>
                            </select>
                            
                            <!-- Filtro por meses mejorado -->
                            <div class="month-filter-container">
                                <div class="month-filter-header">
                                    <button type="button" id="prevMonthBtn" class="month-nav-btn" title="Mes anterior">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <div class="month-display">
                                        <span id="currentMonthDisplay">Enero 2024</span>
                                        <button type="button" id="monthSelectorBtn" class="month-selector-btn" title="Seleccionar mes">
                                            <i class="fas fa-calendar-alt"></i>
                                        </button>
                                    </div>
                                    <button type="button" id="nextMonthBtn" class="month-nav-btn" title="Mes siguiente">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                                <input type="month" id="filterMonth" style="display: none;">
                            </div>
                            
                            <button type="button" id="clearFiltersBtn" class="clear-filters-btn" title="Limpiar filtros">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div id="transactionsList" class="transactions-container">
                        <!-- Las transacciones se cargarán aquí -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Pestaña de Presupuesto -->
        <div id="budget" class="tab-content">
            <div class="budget-section">
                <div class="budget-header">
                    <h3><i class="fas fa-chart-pie"></i> Presupuesto Mensual</h3>
                    <button id="addBudgetBtn" class="add-btn">
                        <i class="fas fa-plus"></i> Agregar Categoría
                    </button>
                </div>
                <div id="budgetList" class="budget-list">
                    <!-- Las categorías de presupuesto se cargarán aquí -->
                </div>
            </div>
        </div>

        <!-- Pestaña de Metas -->
        <div id="goals" class="tab-content">
            <div class="goals-section">
                <!-- Chat con IA para consultas financieras -->
                <div class="ai-chat-section">
                    <h3><i class="fas fa-robot"></i> Asistente IA - Consultas Financieras</h3>
                    <p class="chat-description">Haz preguntas sobre tus finanzas y recibe consejos personalizados basados en tus datos reales</p>
                    
                    <div class="chat-container">
                        <div id="chatMessages" class="chat-messages">
                            <!-- Los mensajes del chat se mostrarán aquí -->
                            <div class="chat-message ai-message">
                                <div class="message-avatar">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="message-content">
                                    <p>¡Hola! Soy tu asistente financiero con IA. Puedo ayudarte a analizar tus gastos, crear metas de ahorro, y darte consejos personalizados basados en tus datos. ¿En qué puedo ayudarte hoy?</p>
                                    <p><small>✅ <strong>Chat con IA activo:</strong> Puedes hacer preguntas sobre tus finanzas.</small></p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chat-input-container">
                            <div class="chat-input-wrapper">
                                <input type="text" id="chatInput" placeholder="Escribe tu pregunta sobre finanzas..." class="chat-input">
                                <button type="button" id="sendChatBtn" class="send-btn" disabled>
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                            <div class="chat-suggestions">
                                <button type="button" class="suggestion-btn" data-suggestion="¿Cuáles son mis mayores gastos este mes?">
                                    <i class="fas fa-chart-pie"></i> Gastos del mes
                                </button>
                                <button type="button" class="suggestion-btn" data-suggestion="¿Cómo puedo ahorrar más dinero?">
                                    <i class="fas fa-piggy-bank"></i> Consejos de ahorro
                                </button>
                                <button type="button" class="suggestion-btn" data-suggestion="¿Cuál es mi balance actual?">
                                    <i class="fas fa-wallet"></i> Balance actual
                                </button>
                                <button type="button" class="suggestion-btn" data-suggestion="¿Qué meta de ahorro me recomiendas?">
                                    <i class="fas fa-target"></i> Meta recomendada
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="add-goal-form">
                    <h3><i class="fas fa-target"></i> Nueva Meta de Ahorro</h3>
                    <form id="goalForm" class="goal-form">
                        <div class="form-row">
                            <input type="text" id="goalName" placeholder="Nombre de la meta" required>
                            <input type="number" id="goalAmount" placeholder="Monto objetivo" step="0.01" required>
                        </div>
                        <div class="form-row">
                            <input type="date" id="goalDeadline" required>
                            <input type="number" id="currentSaved" placeholder="Ya ahorrado" step="0.01" value="0">
                        </div>
                        <textarea id="goalDescription" placeholder="Descripción (opcional)"></textarea>
                        <button type="submit" class="add-btn">
                            <i class="fas fa-plus"></i> Crear Meta
                        </button>
                    </form>
                </div>
                <div id="goalsList" class="goals-list">
                    <!-- Las metas se cargarán aquí -->
                </div>
            </div>
        </div>

        <!-- Pestaña de Categorías -->
        <div id="categories" class="tab-content">
            <div class="categories-section">
                <div class="categories-header">
                    <h3><i class="fas fa-tags"></i> Gestión de Categorías</h3>
                    <button id="addCategoryBtn" class="add-btn">
                        <i class="fas fa-plus"></i> Agregar Categoría
                    </button>
                </div>
                
                <!-- Formulario para agregar nueva categoría -->
                <div class="add-category-form">
                    <h4><i class="fas fa-plus-circle"></i> Agregar Nueva Categoría</h4>
                    <form id="categoryForm" class="category-form">
                        <div class="form-row">
                            <select id="categoryType" required>
                                <option value="">Tipo</option>
                                <option value="income">Ingreso</option>
                                <option value="expense">Gasto</option>
                            </select>
                            <input type="text" id="categoryName" placeholder="Nombre de la categoría" required>
                        </div>
                        <div class="form-row">
                            <input type="color" id="categoryColor" value="#3498db" title="Color de la categoría">
                            <input type="text" id="categoryDescription" placeholder="Descripción (opcional)">
                        </div>
                        <button type="submit" class="add-btn">
                            <i class="fas fa-plus"></i> Agregar Categoría
                        </button>
                    </form>
                </div>
                
                <div class="categories-content">
                    <!-- Categorías de Ingresos -->
                    <div id="incomeCategories" class="category-section">
                        <!-- Las categorías de ingresos se renderizarán aquí -->
                    </div>
                    
                    <!-- Categorías de Gastos -->
                    <div id="expenseCategories" class="category-section">
                        <!-- Las categorías de gastos se renderizarán aquí -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Pestaña de Reportes -->
        <div id="reports" class="tab-content">
            <div class="reports-section">
                <h3><i class="fas fa-chart-bar"></i> Reportes y Análisis</h3>
                <div class="report-controls">
                    <select id="reportPeriod">
                        <option value="current-month">Mes actual</option>
                        <option value="last-6-months">Últimos 6 meses</option>
                        <option value="current-year">Año actual</option>
                    </select>
                    <button id="generateReport" class="add-btn">
                        <i class="fas fa-chart-line"></i> Generar Reporte
                    </button>
                </div>
                <div id="reportResults" class="report-results">
                    <!-- Los reportes se mostrarán aquí -->
                </div>
            </div>
        </div>
    </section>

    <!-- Modal para editar presupuesto -->
    <div id="budgetModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Configurar Presupuesto</h2>
            <form id="budgetForm" class="budget-form">
                <div class="form-row">
                    <input type="text" id="budgetCategory" placeholder="Categoría" required>
                    <input type="number" id="budgetAmount" placeholder="Monto mensual" step="0.01" required>
                </div>
                <button type="submit" class="save-btn">Guardar</button>
            </form>
        </div>
    </div>

    <footer class="footer">
        <p>&copy; Desde 1992 Fede Life. Todos los derechos reservados.</p>
    </footer>

    <script src="/funciones/config-production-fixed.js"></script>
    <script src="/funciones/finanzas-simple.js"></script>
    <script src="/pages/auth.js"></script>
</body>

</html>