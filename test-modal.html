<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Modal - Fede Life</title>
    <link rel="stylesheet" href="pages/app.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-button {
            background: #87ccd8;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .test-button:hover {
            background: #6bb8c4;
        }
        .debug-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>üß™ Test de Modales</h1>

    <div class="debug-info">
        <h3>üîß Informaci√≥n de Debugging</h3>
        <p>Esta p√°gina prueba la funcionalidad de los modales con indicadores visuales.</p>
        <p><strong>Funciones disponibles en consola:</strong></p>
        <ul>
            <li><code>forceShowModals()</code> - Fuerza la visibilidad de todos los modales</li>
            <li><code>listModals()</code> - Lista todos los modales en el DOM</li>
            <li><code>diagnoseFinanceApp()</code> - Diagn√≥stico completo</li>
        </ul>
    </div>

    <button class="test-button" onclick="createTestModal()">
        ü™ü Crear Modal de Prueba
    </button>

    <button class="test-button" onclick="testMultipleModals()">
        üìö Crear M√∫ltiples Modales
    </button>

    <button class="test-button" onclick="forceShowAllModals()">
        üîß Forzar Visibilidad de Modales
    </button>

    <button class="test-button" onclick="clearAllModals()">
        üóëÔ∏è Limpiar Todos los Modales
    </button>

    <div id="results" style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px;">
        <h3>üìä Resultados:</h3>
        <div id="log"></div>
    </div>

    <script src="funciones/config-production-fixed.js"></script>
    <script src="funciones/finanzas.js"></script>

    <script>
        let modalCount = 0;

        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            console.log(message);
        }

        function createTestModal() {
            modalCount++;
            log(`Creando modal de prueba #${modalCount}...`);

            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.id = `test-modal-${modalCount}`;
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header">
                        <h3>üß™ Modal de Prueba #${modalCount}</h3>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <p>Este es un modal de prueba creado din√°micamente.</p>
                        <p><strong>ID del Modal:</strong> ${modalCount}</p>
                        <p><strong>Timestamp:</strong> ${new Date().toLocaleString()}</p>
                        <div style="background: #f0f8ff; padding: 10px; border-radius: 4px; margin: 10px 0;">
                            <strong>üîç Informaci√≥n de Debugging:</strong><br>
                            - Modal creado correctamente<br>
                            - Estilos aplicados<br>
                            - Event listeners configurados
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">
                            <i class="fas fa-times"></i> Cerrar
                        </button>
                        <button class="btn btn-primary" onclick="log('Bot√≥n OK presionado en modal ${modalCount}')">
                            <i class="fas fa-check"></i> OK
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            log(`‚úÖ Modal #${modalCount} creado y agregado al DOM`);

            // Verificar visibilidad
            setTimeout(() => {
                const rect = modal.getBoundingClientRect();
                const computedStyle = window.getComputedStyle(modal);
                log(`üìç Modal #${modalCount} - Posici√≥n: ${rect.top}, ${rect.left} - Visible: ${rect.width > 0 && rect.height > 0} - Display: ${computedStyle.display} - Z-index: ${computedStyle.zIndex}`);
            }, 100);
        }

        function testMultipleModals() {
            log('Creando m√∫ltiples modales...');
            for (let i = 0; i < 3; i++) {
                setTimeout(() => createTestModal(), i * 200);
            }
        }

        function forceShowAllModals() {
            if (window.forceShowModals) {
                window.forceShowModals();
                log('üîß Funci√≥n forceShowModals() ejecutada');
            } else {
                log('‚ùå Funci√≥n forceShowModals() no disponible');
            }
        }

        function clearAllModals() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => modal.remove());
            log(`üóëÔ∏è ${modals.length} modales eliminados`);
            modalCount = 0;
        }

        // Auto-verificaci√≥n al cargar
        window.addEventListener('load', () => {
            log('üöÄ P√°gina cargada');
            log('üìä Modales actuales en DOM: ' + document.querySelectorAll('.modal').length);

            if (window.financeApp) {
                log('‚úÖ FinanceApp disponible');
            } else {
                log('‚ùå FinanceApp no disponible');
            }

            if (window.forceShowModals) {
                log('‚úÖ Funci√≥n forceShowModals disponible');
            } else {
                log('‚ùå Funci√≥n forceShowModals no disponible');
            }
        });

        // Logging de clicks en modales
        document.addEventListener('click', (e) => {
            if (e.target.closest('.modal')) {
                log(`üñ±Ô∏è Click en modal: ${e.target.tagName}.${e.target.className}`);
            }
        });
    </script>
</body>
</html>
